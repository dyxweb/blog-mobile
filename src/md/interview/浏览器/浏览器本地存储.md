## 浏览器本地存储
- Cookie
- WebStorage (localStorage和sessionStorage)
- IndexedDB
### Cookie
> Cookie 最开始被设计出来其实并不是来做本地存储的，而是为了弥补HTTP在状态管理上的不足。HTTP 协议是一个无状态协议，客户端向服务器发请求，服务端无法识别客户端身份。利用 Cookie 向同一个域名下发送请求，都会携带相同的 Cookie，服务器拿到 Cookie 进行解析，便能拿到客户端的状态。而服务端可以通过响应头中的Set-Cookie字段来对客户端写入Cookie。

#### Cookie缺陷
- 容量缺陷：Cookie 的体积上限只有4KB，只能用来存储少量的信息。
- 安全缺陷：Cookie 在每次请求中都会被发送，如果不使用 HTTPS 并对其加密，其保存的信息很容易被窃取，导致安全风险。
- 操作缺陷：Cookie 的操作相对WebStorage较为繁琐复杂。
#### Cookie生存周期
- Cookie 的有效期可以通过Expires和Max-Age两个属性来设置。Expires即过期时间，Max-Age用的是一段时间间隔单位是秒，从浏览器收到报文开始计算。
- 若 Cookie 过期，则这个 Cookie 会被删除，并不会发送给服务端。
- 如果同时指定了Expires和Max-Age，那么Max-Age的值将优先生效。
- 如果没有指定Expires或Max-Age属性，那么这个 Cookie 就是 Session Cookie，即它只在本次对话存在，一旦用户关闭浏览器，浏览器就不会再保留这个 Cookie。
#### Cookie作用域
- 关于作用域有两个属性: Domain和path, 给 Cookie 绑定了域名和路径，在发送请求之前，发现域名或者路径和这两个属性不匹配，那么就不会带上 Cookie。
- 对于路径来说，/表示域名下的任意路径都允许使用 Cookie。
#### Cookie安全相关
- 如果带上Secure，说明只能通过 HTTPS 传输 cookie。
- 如果 cookie 字段带上HttpOnly，那么说明只能通过 HTTP 协议传输，不能通过 JS 访问，这也是预防 XSS 攻击的重要手段。
- 对于 CSRF 攻击的预防，也有SameSite属性。
#### Cookie使用
- 调用document.cookie可以创建、修改 cookie，一次document.cookie能且只能操作一个 cookie。
- 调用document.cookie也可以读到 cookie，能读到所有的非HttpOnly cookie。
### localStorage
> localStorage存储的都是字符串，持久化存储，不手动清除不会消失。

- 使用 Key-Value 形式储存，通过它的 setItem 和 getItem等方法进行操作，使用很方便。
- 大存储小有 10MB。
- Key 和 Value 以字符串形式储存。对于一些复杂的数据存储需要使用JSON.stringify()。
- 只存在客户端，默认不参与与服务端的通信。这样就很好地避免了 Cookie 带来的性能问题和安全问题。
#### 应用场景
- 利用localStorage的较大容量和持久特性，可以利用localStorage存储一些内容稳定的资源。
### sessionStorage
> sessionStorage和localStorage有一个本质的区别，sessionStorage只是会话级别的存储，localStorage是持久化存储。会话结束，也就是页面关闭，这部分sessionStorage就不复存在了。

#### 在该标签或窗口打开一个新页面时会复制当前会话的上下文作为新会话的上下文。
> 多窗口之间sessionStorage不可以共享状态！但是在某些特定场景下新开的页面会复制之前页面的sessionStorage，复制之后的新窗口的sessionStorage和之前窗口的sessionStorage各自独立互不影响。

- window.open("同源页面")这种方式新开的页面会复制之前的sessionStorage，通过a标签新开的页面同样也会。
- 如果不想要这种复制的效果，可以先新建一个空白页面窗口，再将url设置到窗口中的地址栏中去。
#### 应用场景
- 存储信息，保证页面即使刷新也不会让之前的信息丢失。
- 存储本次浏览记录。关闭之后不再需要这些记录。
### IndexedDB
> IndexedDB是运行在浏览器中的非关系型数据库, 本质上是数据库，绝不是和刚才WebStorage的 10M 一个量级，理论上这个容量是没有上限的。

- 键值对存储：内部采用对象仓库存放数据，在这个对象仓库中数据采用键值对的方式来存储。
- 异步操作：数据库的读写属于 I/O 操作, 浏览器中对异步 I/O 提供了支持。
- 受同源策略限制，即无法访问跨域的数据库。
### cookie与session的区别
1. 存储位置不同:cookie的数据信息存放在客户端浏览器上，session的数据信息存放在服务器上。
2. 存储容量不同:单个cookie保存的数据<=4KB，一个站点最多保存20个Cookie，而对于session来说并没有上限，但出于对服务器端的性能考虑，session内不要存放过多的东西，并且设置session删除机制。
3. 存储方式不同:cookie中只能保管ASCII字符串，并需要通过编码方式存储为Unicode字符或者二进制数据。session中能够存储任何类型的数据，包括且不限于string，integer，list，map等。
4. 隐私策略不同:cookie对客户端是可见的，别有用心的人可以分析存放在本地的cookie并进行cookie欺骗，所以它是不安全的，而session存储在服务器上，对客户端是透明的，不存在敏感信息泄漏的风险。
5. 有效期上不同:开发可以通过设置cookie的属性，达到使cookie长期有效的效果。session依赖于名为JSESSIONID的cookie，而cookie JSESSIONID的过期时间默认为-1，只需关闭窗口该session就会失效，因而session不能达到长期有效的效果。
6. 服务器压力不同:cookie保管在客户端，不占用服务器资源。对于并发用户十分多的网站，cookie是很好的选择。session是保管在服务器端的，每个用户都会产生一个session。假如并发访问的用户十分多，会产生十分多的session，耗费大量的内存。
7. 跨域支持上不同:cookie支持跨域名访问(二级域名是可以共享cookie的)。session不支持跨域名访问。